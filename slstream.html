<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Debug SL WebRTC (Click-to-Unmute)</title>
  <style>
    html, body { margin:0; padding:0; height:100%; background:#000; overflow:hidden }
    #player { width:100%; height:100% }
    #overlay {
      position:absolute; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.6); display:flex;
      align-items:center; justify-content:center;
      color:#fff; font-family:sans-serif; font-size:1.2em;
      cursor:pointer; user-select:none; z-index:10;
    }
    #overlay.hidden { display:none }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/ovenplayer@0.13.0/dist/ovenplayer.min.js"></script>
</head>
<body>
  <div id="player"></div>
  <div id="overlay">▶ Click anywhere to enable sound</div>
  <script>
    document.addEventListener('DOMContentLoaded', ()=>{
      const player = OvenPlayer.create('player', {
        debug: true,
        sources: [{
          type: 'webrtc',
          file: 'wss://157.180.45.28:3333/app/stream'
        }],
        autoPlay: true,
        muted:   true,
        loop:    true,
        webrtcConfig: {
          iceServers: [
            { urls: ['stun:stun.l.google.com:19302'] }
          ]
        }
      });

      const overlay = document.getElementById('overlay');
      let videoEl;

      player.on('ready', () => {
        console.log('▶ player ready');
        videoEl = player.getContainer().querySelector('video');
        if (localStorage.getItem('webrtcUnmuted')==='1') {
          console.log('▶ restoring unmuted state');
          videoEl.muted = false;
          videoEl.volume = 1;
          overlay.classList.add('hidden');
        }
      });

      player.on('webrtc:iceConnectionStateChange', state=>{
        console.warn('→ ICE State:', state);
      });

      player.on('firstPlay', ()=>{
        console.log('→ firstPlay: frame has rendered');
      });

      player.on('error', err=>{
        console.error('→ OvenPlayer error:', err);
      });

      overlay.addEventListener('click', ()=>{
        if (videoEl) {
          console.log('▶ unmuting now');
          videoEl.muted = false;
          videoEl.volume = 1;
          videoEl.play().catch(()=>{});
        }
        overlay.classList.add('hidden');
        localStorage.setItem('webrtcUnmuted','1');
      });
    });
  </script>
</body>
</html>
